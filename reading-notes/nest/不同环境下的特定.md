在 NestJS 中，不同的运行模式（预览模式、开发模式、线上模式、测试模式）主要用于适应不同的开发和部署需求，每种模式都可以有不同的配置和行为。以下是这些模式的一些基本区别和用途：

### 1. 预览模式（Preview Mode）
- **用途**：通常用于在开发过程中预览新功能或更改。这种模式可能启用特定的日志记录、调试工具或配置，以便开发者可以评估应用的行为。
- **特点**：可能包括增强的错误报告、API的临时变更预览等。

### 2. 开发模式（Development Mode）
- **用途**：用于日常开发工作。在这种模式下，应用通常配置为提供详细的错误信息和调试支持。
- **特点**：
  - 自动重载：代码更改后自动重新启动应用。
  - 详细的日志记录：帮助开发者跟踪应用流程和错误。
  - 调试支持：可能包括更多的调试信息，如堆栈跟踪和内存使用数据。

### 3. 线上模式（Production Mode）
- **用途**：用于部署到生产环境。这种模式优化了性能和安全性，通常禁用了不必要的调试和日志记录功能。
- **特点**：
  - 性能优化：启用缓存、减少资源消耗、优化数据库查询等。
  - 安全性增强：可能包括更严格的安全措施，如HTTPS强制、CORS策略等。
  - 错误处理：通常不向用户显示详细的错误信息，以避免敏感信息泄露。

### 4. 测试模式（Test Mode）
- **用途**：用于执行自动化测试，如单元测试、集成测试和端到端测试。这种模式通常配置为与测试工具和框架集成，如 Jest 或 Mocha。
- **特点**：
  - 测试配置：可能包括测试数据库、模拟对象、测试专用的服务等。
  - 快速启动和关闭：为了快速执行测试，应用配置为快速启动和关闭。
  - 独立性：测试环境通常与开发和生产环境隔离，以避免相互影响。

### 配置和切换
在 NestJS 中，可以通过环境变量（如 `NODE_ENV`）来控制应用的运行模式。例如，设置 `NODE_ENV=production` 通常会触发线上模式的配置。此外，NestJS 的配置模块（`@nestjs/config`）可以帮助管理不同环境下的配置差异。

```typescript
if (process.env.NODE_ENV === 'development') {
  console.log('Development mode');
} else if (process.env.NODE_ENV === 'production') {
  console.log('Production mode');
}
```

这种模式的管理和切换机制使得 NestJS 应用能够灵活地适应不同的开发和部署场景，从而提高开发效率和应用性能。